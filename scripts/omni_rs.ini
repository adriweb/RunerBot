[script]
n0=on *:input:*: {
n1=  set %omni.input omni.check $mnick $chan 0 $1-
n2=  .timer 1 0 %omni.input | unset %omni.input
n3=  if $regex($strip($1),/^\/\/?(quit|disconnect|exit)$/) {
n4=    set -eu1 %dontreconnect 1
n5=  }
n6=}
n7=on *:text:*:*: {
n8=  if $regex($strip($1-),/<([^>]+)> (.+)/) {
n9=    var %nick $replace($regml(1),$chr(32),$chr(160))
n10=    var %msg $regml(2)
n11=    omni.check %nick $chan 1 %msg
n12=  }
n13=  else if $regex($strip($1-),/\[([^\]]+)\] (.+)/) {
n14=    var %nick $replace($regml(1),$chr(32),$chr(160))
n15=    var %msg $regml(2)
n16=    omni.check %nick $chan 1 %msg
n17=  }
n18=  else {
n19=    omni.check $nick $chan 0 $1-
n20=  }
n21=}
n22=on *:sockopen:omni.test: {
n23=  echo -s sockopen $sockname $+ 
n24=  sockwrite -nt $sockname $+(GET /index.php?wap;action=unread HTTP/1.1,$crlf,Host: omnimaga.org,$crlf,$crlf)
n25=}
n26=on *:sockread:omni.test: {
n27=  var %x
n28=  sockread %x
n29=  echo -s sockread $sockname $+  %x
n30=}
n31=on *:connect: {
n32=  if ($me == $anick) {
n33=    nick $mnick
n34=    timeromni.nick 0 60 omni.nick
n35=  }
n36=  join #omnimaga
n37=  join #omnimaga-spam
n38=  join #omnimaga-ops
n39=  join #fishtankcity
n40=  join #cemetech
n41=  join #tiplanet
n42=  join #cemu-dev
n43=  join #ez80-dev
n44=  join #ti
n45=  join #tiboy-testing
n46=  join #tipython-dev
n47=}
n48=on *:disconnect: {
n49=  if !%dontreconnect {
n50=    server irc.efnet.org
n51=  }
n52=}
n53=on *:quit: {
n54=  if ($nick == $mnick) && ($me == $anick) {
n55=    nick $mnick
n56=  }
n57=  if $regex($1-,/^[^.]+\.[^.]+\.[^.]+ [^.]+\.[^.]+\.[^.]+$/) || $regex($1-,/^Ping timeout:/) {
n58=    if %efnet.netsplit.threshold == $null {
n59=      var %nicklist
n60=      var %chan 1
n61=      while %chan <= $chan(0) {
n62=        var %c $chan(%chan)
n63=        var %nick 1
n64=        while %nick <= $nick(%c,0) {
n65=          var %n $nick(%c,%nick)
n66=          if !$istok(%nicklist,%n,32) {
n67=            set %nicklist %nicklist %n
n68=          }
n69=          inc %nick
n70=        }
n71=        inc %chan
n72=      }
n73=      set -eu60 %efnet.netsplit.threshold $calc($numtok(%nicklist,32) / 2)
n74=    }
n75=    set -eu60 %efnet.netsplit.counter $calc(%efnet.netsplit.counter + 1)
n76=    if %efnet.netsplit.counter >= %efnet.netsplit.threshold {
n77=      unset %efnet.netsplit*
n78=      server irc.efnet.org
n79=    }
n80=  }
n81=}
