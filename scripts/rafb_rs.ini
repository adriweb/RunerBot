[script]
n0=on *:sockopen:rafb*: {
n1=  ;echo -s sockopen $sockname
n2=  var %params $gettok($sock($sockname).mark,1,32)
n3=  var %file $gettok($sock($sockname).mark,2,$asc("))
n4=  sockmark $sockname $gettok($sock($sockname).mark,3-,$asc("))
n5=  var %len $len(%params)
n6=  var %i 1
n7=  while %i <= $lines(%file) {
n8=    var %r $read(%file,nt,%i)
n9=    inc %len $len($encodeurl(%r))
n10=    inc %len 3
n11=    inc %i
n12=  }
n13=  sockwrite -n $sockname POST /paste.php HTTP/1.1
n14=  sockwrite -n $sockname Host: rafb.me
n15=  sockwrite -n $sockname Content-Type: application/x-www-form-urlencoded
n16=  sockwrite -n $sockname Content-length: %len
n17=  sockwrite $sockname $crlf
n18=  sockwrite $sockname %params
n19=  var %i 1
n20=  while %i <= $lines(%file) {
n21=    var %r $read(%file,nt,%i)
n22=    sockwrite $sockname $+($encodeurl(%r),%,0A)
n23=    inc %i
n24=  }
n25=  .timer $+ $sockname 1 1 rafb.return $sockname error
n26=}
n27=on *:sockread:rafb*: {
n28=  var %r
n29=  sockread %r
n30=  ;echo -s sockread $sockname %r
n31=  if (HTTP/1.1 302* iswm %r) {
n32=    sockread %r
n33=    ;echo -s sockread $sockname %r
n34=    sockread %r
n35=    ;echo -s sockread $sockname %r
n36=    sockread %r
n37=    ;echo -s sockread $sockname %r
n38=    if $regex(%r,/^Location: (.+)$/i) {
n39=      rafb.return $sockname $regml(1)
n40=    }
n41=  }
n42=  rafb.return $sockname error
n43=}
