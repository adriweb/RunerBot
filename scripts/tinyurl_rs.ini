[script]
n0=on *:sockopen:tinyurl*: {
n1=  ;echo -s sockopen $sockname $sock($sockname).mark
n2=  sockwrite -n $sockname GET /create.php?format=simple&url= $+ $gettok($sock($sockname).mark,1,32) HTTP/1.1
n3=  sockwrite -n $sockname Host: is.gd
n4=  sockwrite $sockname $crlf
n5=}
n6=on *:sockread:tinyurl*: {
n7=  var %r
n8=  sockread %r
n9=  ;echo -s sockread $sockname %r
n10=  if 0 {
n11=    if ((HTTP/* iswm %r) && ($gettok(%r,2,32) != 200)) || (ERROR* iswm %r) {
n12=      tinyurl.return $sockname $gettok($sock($sockname).mark,1,32)
n13=      halt
n14=    }
n15=    if http://* iswm %r {
n16=      tinyurl.return $sockname %r
n17=      halt
n18=    }
n19=  }
n20=  if HTTP/1.1 200 OK == %r {
n21=    while $sockbr {
n22=      if http://* iswm %r {
n23=        tinyurl.return $sockname %r
n24=        halt
n25=      }
n26=      sockread %r
n27=      ;echo -s sockread $sockname %r
n28=    }
n29=  }
n30=  tinyurl.return $sockname $gettok($sock($sockname).mark,1,32)
n31=  halt
n32=}
